import{_ as a,o as s,c as n,Q as e}from"./chunks/framework.8048b864.js";const h=JSON.parse('{"title":"sendBeacon","description":"","frontmatter":{},"headers":[],"relativePath":"MiscellaneousTalk/P3 你不知道的JavaScript/6.sendBeacon.md","filePath":"MiscellaneousTalk/P3 你不知道的JavaScript/6.sendBeacon.md"}'),l={name:"MiscellaneousTalk/P3 你不知道的JavaScript/6.sendBeacon.md"},o=e(`<h1 id="sendbeacon" tabindex="-1">sendBeacon <a class="header-anchor" href="#sendbeacon" aria-label="Permalink to &quot;sendBeacon&quot;">​</a></h1><h2 id="sendbeacon-是什么" tabindex="-1">sendBeacon 是什么？ <a class="header-anchor" href="#sendbeacon-是什么" aria-label="Permalink to &quot;sendBeacon 是什么？&quot;">​</a></h2><ul><li>sendBeacon() 是 HTML5 引入的一种 API，属于 Navigator 对象的一部分。</li><li>在 Web 浏览器中，它允许开发者在页面卸载（unload）时异步且无阻塞地向服务器发送少量数据。即使用户关闭了浏览器窗口或标签页，该方法也能确保数据的发送</li></ul><h2 id="sendbeacon-解决的问题" tabindex="-1">sendBeacon 解决的问题 <a class="header-anchor" href="#sendbeacon-解决的问题" aria-label="Permalink to &quot;sendBeacon 解决的问题&quot;">​</a></h2><ul><li><p>页面生命周期结束后的数据发送：</p><ul><li><p>在传统的页面生命周期管理中，当用户离开一个网页时，尚未完成的网络请求通常会被浏览器取消，导致一些重要统计数据或诊断信息无法成功发送到服务器。</p></li><li><p>sendBeacon() 解决了这个问题，保证在页面关闭前能够将这些数据发送出去，即便网络状况不佳或者用户快速退出页面。</p></li></ul></li><li><p>性能优化：</p><ul><li>由于 sendBeacon()使用的是异步非阻塞模式，所以它不会影响页面的加载速度或用户的交互体验，特别适合于发送那些对时间敏感但并非关键任务的数据。</li></ul></li></ul><h3 id="在会话结束时发送统计数据" tabindex="-1">在会话结束时发送统计数据 <a class="header-anchor" href="#在会话结束时发送统计数据" aria-label="Permalink to &quot;在会话结束时发送统计数据&quot;">​</a></h3><ul><li>网站通常希望在用户完成页面浏览后向服务器发送分析或诊断数据，最可靠的方法是在 <code>visibilitychange</code> 事件发生时发送数据</li></ul><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">document.</span><span style="color:#B392F0;">addEventListener</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;visibilitychange&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">logData</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (document.visibilityState </span><span style="color:#F97583;">===</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;hidden&quot;</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    navigator.</span><span style="color:#B392F0;">sendBeacon</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;/log&quot;</span><span style="color:#E1E4E8;">, analyticsData);</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">document.</span><span style="color:#6F42C1;">addEventListener</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;visibilitychange&quot;</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">logData</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (document.visibilityState </span><span style="color:#D73A49;">===</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;hidden&quot;</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">    navigator.</span><span style="color:#6F42C1;">sendBeacon</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;/log&quot;</span><span style="color:#24292E;">, analyticsData);</span></span>
<span class="line"><span style="color:#24292E;">  }</span></span>
<span class="line"><span style="color:#24292E;">});</span></span></code></pre></div><h3 id="避免使用-unload-和-beforeunload" tabindex="-1">避免使用 unload 和 beforeunload <a class="header-anchor" href="#避免使用-unload-和-beforeunload" aria-label="Permalink to &quot;避免使用 unload 和 beforeunload&quot;">​</a></h3><ul><li><p>许多<code>网站使用 unload 或 beforeunload 事件</code>以在会话结束时发送统计数据。然而这是不可靠的，在许多情况下（尤其是移动设备）浏览器<code>不会产生 unload、beforeunload 或 pagehide 事件</code>。下面列出了一种不触发上述事件的情况：</p><ul><li>用户加载了网页并与其交互。</li><li>完成浏览后，用户切换到了其他应用程序，而不是关闭选项卡。</li><li>随后，用户通过手机的应用管理器关闭了浏览器应用</li></ul></li></ul><h2 id="参考文献" tabindex="-1">参考文献 <a class="header-anchor" href="#参考文献" aria-label="Permalink to &quot;参考文献&quot;">​</a></h2><ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Navigator/sendBeacon" target="_blank" rel="noreferrer">https://developer.mozilla.org/zh-CN/docs/Web/API/Navigator/sendBeacon</a></li></ul>`,12),t=[o];function p(c,i,r,d,u,E){return s(),n("div",null,t)}const b=a(l,[["render",p]]);export{h as __pageData,b as default};
